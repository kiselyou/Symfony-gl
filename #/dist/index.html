<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Iron War</title>
    <link rel="icon" type="image/x-icon" href="/app/iron-war.ico" />

    <link rel="stylesheet" href="/app/css/theme.min.css">

    <script type="application/javascript" src="/app/js/jquery.min.js"></script>

</head>
<body>

    <script type="application/javascript" src="/app/js/socket.io.js"></script>
    <script type="application/javascript" src="/app/js/stats.min.js"></script>

    <script src="/app/js/iw.min.js"></script>

    <script type="application/javascript">


        let ajax = new IW.Ajax();
        ajax.get('/socket/info/socket_lock', {}, (data) => {
            try {
                let res = JSON.parse(data);

                if (res.hasOwnProperty('config')) {
                    let lock = true,
                        conf = res['config'],
                        socket = io.connect(conf['socket']);

                    // connect
                    socket.on('connected', (data) => {
                        socket.emit('except-sender', {userID: conf.userID, senderID: data.clientID});
                    });

                    // listen
                    socket.on('except-sender', (data) => {
                        if (data.userID && data.userID === conf.userID && lock) {
                            socket.emit('event_lock', {receiverID: data.senderID});
                        }
                    });

                    socket.on('event_lock', (data) => {
                        lock = false;
                        let tmp = new IW.Templates();
                        tmp.load('/controller/lock/lock.html', (html) => {
                            tmp.paste('body', html, 3);
                        });
                    });
                }
            } catch (e) {
                console.log(e);
            }

        }, () => {
            console.warn('Error +++');
        });

    </script>

</body>
</html>
