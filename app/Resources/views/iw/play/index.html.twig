{% extends 'iw.html.twig' %}

{% block sw_container %}

    <div id="iw-container"></div>

{% endblock %}

{% block javascripts %}

    {{ parent() }}

    <script type="application/x-glsl" id="sky-vertex">
        varying vec2 vUV;

        void main() {
          vUV = uv;
          vec4 pos = vec4(position, 1.0);
          gl_Position = projectionMatrix * modelViewMatrix * pos;
        }
        </script>

            <script type="application/x-glsl" id="sky-fragment">
        uniform sampler2D texture;
        varying vec2 vUV;

        void main() {
          vec4 sample = texture2D(texture, vUV);
          gl_FragColor = vec4(sample.xyz, sample.w);
        }
    </script>

    <script type="application/javascript">

        document.addEventListener('DOMContentLoaded', function () {

            /**
             *
             * @type {IW.MultiLoader}
             */
            var multiLoader = new IW.MultiLoader();

            var initScene = new IW.SceneControls( multiLoader, 'iw-container', false );

            var skyBoxName = 'sky-box-stars';
            multiLoader.addLoadTexture( skyBoxName, 'TEST - texture', '{{ asset('/images/textures/skybox/stars-4096x2048.png') }}' );

            // UPLOAD SHIPS
            multiLoader.addLoadOBJ( IW.SceneControls.MODEL_S1_A, 'SHIPS - A', '{{asset('/models/S1/A/')}}', 'starship.obj', 'starship.mtl' );
            multiLoader.addLoadOBJ( IW.SceneControls.MODEL_S1_B, 'SHIPS - B', '{{asset('/models/S1/B/')}}', 'ship.obj', 'ship.mtl' );
            // UPLOAD ROCKETS
            multiLoader.addLoadOBJ( IW.ModelShot.MODEL_R1_A, 'ROCKETS - A', '{{asset('/models/R1/A/')}}', 'rocket.obj', 'rocket.mtl' );
            // UPLOAD CONFIGS
            multiLoader.addLoadJSON( IW.PanelControls.CONFIG_ACTION, 'CONFIG', '{{asset('/js/config/action.json')}}', true );
            multiLoader.addLoadJSON( IW.ModelShot.CONFIG_WEAPON, 'CONFIG', '{{asset('/js/config/weapon.json')}}', true );

            multiLoader.setLoadedCallback( function ( params ) {
                switch ( params.name ) {

                    case IW.SceneControls.MODEL_S1_A:

                        params.object.children[0].position.y = -80;
                        params.object.scale.copy( new THREE.Vector3( 0.1, 0.1, 0.1 ) );
                        break;
                }
            } );

            multiLoader.load(function () {
                initScene.skyBox( skyBoxName );
                initScene.play();
            });
        });
    </script>

{% endblock %}