{% extends 'base.html.twig' %}

{% block stylesheets %}
    <link href="{{ asset('css/theme-galaxy.css') }}" rel="stylesheet" />
{% endblock %}

{% block body %}

    <style>
        #mapCanvas {
            border: solid 1px #f00;
        }
    </style>

    <div id="sw-container"></div>
    {#<div id="mapCanvas" style="position: absolute; left:100px; top:100px; width:320px; height:240px; background: #ffffff"></div>#}

{% endblock %}

{% block javascripts %}

    <script src="{{ asset('js/core/api/Array.js') }}"></script>
    <script src="{{ asset('js/three/three.js') }}"></script>


    <script src="{{ asset('js/three/dat.gui.min.js') }}"></script>

    <script src="{{ asset('js/three/EffectComposer.js') }}"></script>
    <script src="{{ asset('js/three/RenderPass.js') }}"></script>
    <script src="{{ asset('js/three/ShaderPass.js') }}"></script>
    <script src="{{ asset('js/three/FXAAShader.js') }}"></script>
    <script src="{{ asset('js/three/CopyShader.js') }}"></script>

    <script src="{{ asset('models/ModelData.js') }}"></script>
    <script src="{{ asset('js/three/loaders/OBJLoader.js') }}"></script>
    <script src="{{ asset('js/three/controls/PlanetControls.js') }}"></script>
    <script src="{{ asset('js/three/controls/OrbitControls.js') }}"></script>
    <script src="{{ asset('js/three/controls/ModelControls.js') }}"></script>







    <script>
        document.addEventListener("DOMContentLoaded", function () {

            var container = document.getElementById( 'sw-container' );

            var WIDTH = window.innerWidth;
            var HEIGHT = window.innerHeight;

            var MAP_WIDTH = 320;
            var MAP_HEIGHT = 240;
            var MAP_LEFT = WIDTH - MAP_WIDTH - 10;
            var MAP_TOP = HEIGHT - MAP_HEIGHT - 10;

            var mapCanvas = document.createElement('div');
            mapCanvas.id = 'mapCanvas';
            mapCanvas.style.position = 'absolute';
            mapCanvas.style.width = MAP_WIDTH + 'px';
            mapCanvas.style.height = MAP_HEIGHT + 'px';
            mapCanvas.style.left = MAP_LEFT + 'px';
            mapCanvas.style.top = MAP_TOP + 'px';
            container.parentNode.insertBefore(mapCanvas, container.nextSibling);



            var gui = new dat.GUI();

            var params = {
                near: -1000,
                far: 1000,
                up: {
                    x: 0,
                    y: 0,
                    z: -1
                },
                lookAt: {
                    x: 0,
                    y: 1,
                    z: 0
                },

                scale: 2,
                ta: {
                    w: 320,
                    h: 240
                },
                s: {
                    w: 320,
                    h: 240
                }
            };

            gui.add( params, 'near', -10000, 10000 );
            gui.add( params, 'far', -10000, 10000 );
            gui.add( params.up, 'x', -10, 10 );
            gui.add( params.up, 'y', -10, 10 );
            gui.add( params.up, 'z', -10, 10 );
            gui.open();

            var aspect =  WIDTH / HEIGHT;

            var scene = new THREE.Scene();
            var renderer = new THREE.WebGLRenderer();
            renderer.setSize( WIDTH, HEIGHT );
            container.appendChild( renderer.domElement );

            // CAMERA
            var camera = new THREE.PerspectiveCamera( 45, aspect, 0.1, 1000000 );
            camera.aspect = aspect;
            camera.position.x = 100;
            camera.position.z = 100;
            camera.position.y = 100;
            camera.lookAt(scene.position);
            scene.add(camera);

            // LIGHT
            var hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
            hemiLight.color.setHSL( 0.6, 1, 0.6 );
            hemiLight.groundColor.setHSL( 0.095, 1, 0.75 );
            hemiLight.position.set( 0, 500, 0 );
            scene.add( hemiLight );

            // LIGHT
            var dirLight = new THREE.DirectionalLight( 0xffffff );
            dirLight.color.setHSL( 0.1, 1, 0.95 );
            dirLight.position.set( -1, 1.75, 1 );
            dirLight.position.multiplyScalar( 5 );

            scene.add( dirLight );



            // PLANETS
            var planetControls = new THREE.PlanetControls( scene, camera );
            planetControls.load( true, function ( a, b ) {
                console.log( a, b );
            } );

            // GRID
            var color = new THREE.Color( 0x00ffff );
            var grid = new THREE.GridHelper( 1000, 100, color, 0x888888 );
            scene.add( grid );

            // MODEL CONTROL
            var modelControls = new THREE.ModelControls( camera, scene, renderer.domElement, container );
            modelControls.loadObject( 'models/M1/Spaceship1.obj', function ( object ) {
                object.children[0].rotateX(Math.PI / 2);
                object.children[0].rotateY(Math.PI);
            } );

            modelControls.addIntersectExceptUUID( grid.uuid );

            window.addEventListener( 'resize', windowResize, false );
            render();

            function windowResize () {
                var w = window.innerWidth;
                var h = window.innerHeight;
                camera.aspect = w / h;
                camera.updateProjectionMatrix();
                renderer.setSize( w, h );
            }

            function render () {

                var w = window.innerWidth, h = window.innerHeight;


                requestAnimationFrame( render );

                planetControls.update();
                modelControls.update();

                renderer.render( scene, camera );
            }
        });
    </script>
{% endblock %}
